# 鸿蒙南向开发笔记总结

### 1.概述

------



- **概念**

鸿蒙南向开发指的是针对鸿蒙系统的内核和驱动进行的开发工作。在鸿蒙系统的架构中，开发工作大致可以分为南向开发和北向开发。南向开发关注于系统的底层，包括***内核和驱动的开发***；而北向开发则主要关注于应用层，即App应用的开发。

- **开发环境**

鸿蒙南向开发通常需要在Linux环境下进行，如Ubuntu系统。Windows环境下虽然可以进行代码的编辑，但大部分的开发板源码还不支持在Windows环境下进行编译。

可以使用DevEco Device Tool等开发工具进行代码的编辑、编译和调试



### 2.wsl2配置

------

**2.1.打开相关服务或功能**

- 需要确保BIOS（基本输入输出系统）中的**虚拟化技术**（Virtualization Technology）是打开的
- 在控制面板--程序--启用或关闭windows功能中打开 **适用于Linux的Windows子系统**、 **Hyper-V**、**虚拟机平台**

**2.2下载wsl**

- 在github--microsoft/wsl--release--Assert中下载wsl

**2.3安装Ubuntu**

- 利用命令行下载

  ```c
  wsl --list --online    可安装的有效分发的列表(可查看可安装的Ubuntu版本)
  ```

  ```c
  wsl --install Ubuntu(选择需要安装的版本)
  ```


- 利用微软商店下载
  - 下载时需关闭代理

**2.3.下载Linux版本的device-tool**

- 参考https://docs.openharmony.cn/pages/v4.1/zh-cn/device-dev/quick-start/quickstart-ide-env-ubuntu.md

**2.4.获取openharmony源码**

- 创建工程自动下载

  ​

  ​

### 3.编写简单程序

------



> **openharmony源码主要目录结构**

| 目录名称        | 描述                                                         |
| --------------- | ------------------------------------------------------------ |
| **build**       | 包含构建OpenHarmony的相关脚本和配置文件。例如，build.sh是一个用于构建整个系统的脚本，build.gradle是配置Gradle构建的文件。 |
| **foundation**  | 包含基础组件，如内存管理、文件系统和网络协议栈等。这些组件为上层框架和应用程序提供基础功能。 |
| **frameworks**  | 包含应用框架和系统服务。应用框架提供应用程序的运行环境和开发接口，如界面显示、用户输入和应用管理等。系统服务则提供设备管理、权限控制和通信接口等系统级功能。 |
| **hardware**    | 包含与硬件相关的代码，如设备驱动和硬件抽象层。这些代码用于与硬件进行通信和控制，以支持OpenHarmony在不同硬件设备上的运行。 |
| **prebuilts**   | 包含预编译的库和工具。这些库和工具可以直接使用，无需重新编译，有助于加速开发过程。 |
| **system**      | 包含OpenHarmony的系统核心代码，包括内核、启动引导程序和系统服务等。这些代码负责管理系统资源和提供系统功能。 |
| **third_party** | 包含第三方开源库，如SQLite、libjpeg和libpng等。这些库提供了一些常用的功能，可以在OpenHarmony中直接使用。 |
| **tools**       | 包含开发工具，如编译器、调试器和性能分析工具等。这些工具帮助开发者进行开发、调试和优化工作。 |
| **vendor**      | 包含供应商相关的代码。这些代码用于支持特定设备的功能和特性，有助于设备制造商在OpenHarmony平台上进行定制开发。 |

参考(https://docs.openharmony.cn/pages/v4.1/zh-cn/device-dev/quick-start/quickstart-ide-3861-helloworld.md)  

**3.1确定目录结构**

- 在根目录下新建文件夹

**3.2编写业务代码**

**3.3编写用于将业务构建成静态库的BUILD.gn文件**

**3.4添加新组件**

**3.5修改单板配置文件**





### 4.源码编译

------

- **编译**

build命令

```c
./build.sh --product-name rk3568 --ccache 
```

hb命令

```c
hb set   // 选择编译的ohos版本，硬件产品型号
hb build // 开始编译    
```







### 5.子系统

------

### 根目录下主要目录

| 目录名称     | 描述                                           |
| ------------ | ---------------------------------------------- |
| applications | 存放应用程序                                   |
| arkcompiler  | Ark编译器相关文件                              |
| base         | 基础软件服务（注意：不与子系统集名直接对应）   |
| build        | 编译目录和脚本                                 |
|              |                                                |
| domains      | 硬件服务子系统集及其他特定服务子系统的顶级目录 |
| foundation   | 系统基本能力子系统集目录                       |
|              |                                                |

### 配置文件

| 配置文件路径         | 描述                                 |
| -------------------- | ------------------------------------ |
| rk3568/config.json   | 修改特定设备（如rk3568）的子系统配置 |
| build/subsystem.json | 定义所有子系统名称和配置             |

### 构建和配置相关文件

| 文件名称              | 描述                                                 |
| --------------------- | ---------------------------------------------------- |
| BUILD.gn              | 子系统构建脚本，定义构建规则（Ohos4.0+需要）         |
| bundle.json           | 子部件描述文件，定义部件名称和子部件信息（Ohos4.0+） |
| subsystem_config.json | 在此文件中添加新建子系统的配置字段                   |



### 6.分布式硬件

------

- **作用**：实现了不同设备之间硬件资源的共享和调用

- **优势与特点**：它能够打破设备之间的界限，实现硬件资源的全局共享和调用。这不仅可以**提升用户体验**（如无缝切换设备、跨设备协同操作等），还可以**提高设备的利用率和效率**（如根据任务需求选择合适的设备来运行）。此外，分布式硬件还降低了开发者的开发难度和成本，因为他们无需为不同设备编写独立的驱动程序和接口代码。

- **FULL-SDK的编译与构成**

  **FULL-SDK** 是OpenHarmony系统级别的软件开发工具包（Software Development Kit），它包含了开发OpenHarmony应用所需的所有系统级API和基础库。这个SDK通常需要从OpenHarmony的源代码进行编译生成，因为它依赖于具体的系统实现和API。

  - **BaseSDK**：基础SDK，包含了OpenHarmony系统的基础功能库和API。
  - **SystemAPI**：系统级API，提供了与操作系统底层交互的接口，用于实现更高级的功能。

  通过组合BaseSDK和SystemAPI，开发者可以获得一个完整的、可用于开发OpenHarmony应用的FULL-SDK。

- **SDK文件的生成与使用**

  编译完成后，SDK文件将被放置在`out/sdk/packages/ohos-sdk`目录下。这个目录下包含了多个子目录，其中`//windows`目录（注意这里的路径表示可能有些不精确，实际可能是类似`windows`或`ohos-sdk-windows`的目录名）包含了适用于Windows平台的完整SDK文件。

- **分布式硬件的权限管理**

  - **分布式设备认证组网权限**：允许设备在加入分布式网络时进行身份验证和组网。这是实现设备间安全通信的基础。
  - **设备间的数据交换权限**：允许设备之间安全地交换数据。这包括定义哪些数据可以共享、如何共享以及谁可以访问这些数据。



### 

