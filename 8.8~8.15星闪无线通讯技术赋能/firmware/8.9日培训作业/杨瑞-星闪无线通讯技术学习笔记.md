---
title: 星闪无线通讯技术学习笔记
authors: pete
keywords:
  - NearLink
  - WS63E
  - 星闪
---
# 星闪无线通讯技术学习笔记
> NearLink_DK_WS63E采用海思星闪WS63E的解决方案具备对802.11b/g/n/ax无线通信协议的支持，同时兼容BLE5.3协议，具备BLE Mesh和BLE网关能力；支持SLE1.0协议及SLE网关功能；具备雷达人体活动检测能力；可基于OpenHarmony轻量系统开发物联网场景功能。


## 主要功能
> 星闪的接入层共设有 SLB（SparkLink Basic，星闪基础接入技术）和 SLE（SparkLink-LowEnergy，星闪低功耗接入技术）这两种通讯接口，并为基础服务层和应用层提供了相应的安全机制。 在两种界面中，SLB 更偏重高速率、高同步、高并发、高安全的连结。 而 SLE 则是专为低功耗的轻量级链接而设，且有一对多特性和能提升传输可靠性的 Polar 信号编码。 简而言之，你可以把 Wi-Fi 和蓝牙视作它们各自的比对目标。

 - 支持 Wi-Fi、BLE 或 SLE 三种组网方式，BLE Mesh 组网
 - 支持雷达感知功能
 - 支持USB 5V 供电，以及USB转UART用于下载升级固件和主机通信。
 - 支持 power-on 复位按键，支持用户自定义按键
 - 支持板载 PCB 天线或 IPEX 座子外置天线。
 - 支持19个 GPIO，可复用为 PWM、ADC 采集通道、SPI 接口、QSPI接口、I2C接口、I2S 接口、UART接口
 
## 指令说明
### AT指令
- 介绍
  - AT指令是应用于终端设备与PC应用之间的连接与通信的指令。AT 即Attention。每个AT命令行中只能包含一条AT指令；对于AT指令的发送。
  - 使用AT指令与串口通信，是一种“礼尚往来”的通信方式，即当控制端输入一个AT指令后，与之通信的外部设备将会回复一个结果，就这样一对一的进行。
- 类型
    - AT指令分为以下几种：
        - 测试指令 AT+<cmd>=? 该命令用于查询设置指令的参数以及取值范围
        - 查询指令 AT+<cmd>? 该命令用于返回参数的当前值
        - 设置指令 AT+<cmd>=<parameter>, … 设置参数值或执行。
        - 执行指令 AT+<cmd> 用于执行本指令的功能
    - 开发板串口通信默认：波特率为 115200、8 个数据位、 1 个停止位、无校验，无流量控制。
### 通用AT指令列表
- AT+HELP 查看当前可用 AT 命令   
    1. 格式：AT+HELP

- AT+MAC MAC 地址管理。
   1. 格式:
      - 设置命令：AT+MAC=< MAC >
      - 查询命令：AT+MAC?

   2. 返回示例：AT+MAC=90：2B：D2：E4：CE：28，AT+MAC？

- AT+IPERF 性能测试。
   1. 格式：AT+IPERF=<-x>

   2. 参数说明：
      - -s ：以 server模式启动
      - -c,IP：以 client 模式启动， IP 为 server 端地址 
      - -u：使用udp协议
      - -i,sec：以秒为单位显示报告间隔
      - -t,sec：测试时间，默认30s
      - -b,Bandwidth：udp 发送带宽，单位为 bps，如设置为10K、 20M，默认值为 1Mbp
      - -l,length：单次发送数据长度，单位为字节
      - -B, IP：绑定一个主机 IP 地址，当主机有多个地址或接口时使 用该参数
      - -p,portNum：指定服务器端使用的端口或客户端所连接的端口 
      -  -k：停止 iperf

   3. 示例：
      - AT+IPERF=-s,-i,1：以 server 模式启动 iperf，使用协议默认为 tcp，显示报告以 1s 为时间

   4. 注意事项：
      -  -c 或者-s须放在第一个参数位置。
      -  -s 使用时，须使用-k 结束才能进行下一次启动。
      -  -s 使用时，如果打流结束， iperf server 进程会自动关闭，再次测试需要重新起 server
      -  仅支持一次执行，不支持多实例同时进行。

- AT+SYSINFO 查看系统信息。
   1. 格式：AT+SYSINFO 

   2. 显示：显示 SDK 版本号和系统当前所有任务详细信息，如任务 ID 、优先级、栈内存大小、调度状态等

- AT+PING 测试 IPV4 网络连接。
   1. 格式：AT+PING=[< -x >,]< IP >

   2. 示例：
      - AT+PING= 192.168.3.1 ： 执 行 ping 192.168.3.1 ，默认ping4个包
      - AT+PING=-w,1,192.168.3.1 ：执行 ping192.168.3.1 ，相邻两次ping 包的时间间隔为 1ms
      - AT+PING=-l,100,192.168.3.1 ：执行 ping192.168.3.1 ，设置单次发送包长最大为 100Byte

- AT+PING6 测试 IPV6 网络连接。
   1. 格式：AT+PING6=[< -x >,]< IP >

   2. 示例：
      -  AT+PING6=2001:  a : b : c : d : e : f : b
      -  AT+PING6=-c,100,2001:  a : b : c : d : e : f : b
      -  AT+PING6=-k

- AT+ DNS 设置单板 dns 服务器地址。
   1. 格式：
      -  设置命令：AT+DNS=<dns_num>,<IP>
      -  查询命令：AT+DNS?

   2. 示例：
      -  AT+ DNS?
      -  AT+DNS=1,192.168.3.1
      -  AT+DNS=2,192.168.3.2
- AT+NETSTAT 查看网络状态。
   1. 格式：AT+NETSTAT

   2. 参数说明：
      Send-Q：对 TCP 连接， 已发送但未确认的数据量； 对 UDP 连接，由于 IP 地址解析未完成而缓存的数据 

- AT+DHCP dhcp 客户端命令。

- AT+DHCPS dhcps 服务器端命令。
    1.  格式：AT+DHCPS=<ifname>,<stat>

    2.  示例：AT+DHCPS=ap0,1

    3.  注意：网卡名称与 AT+IFCFG 查看的 AP 网卡名称保持一致

- AT+IFCFG 接口配置。
    1.  格式：
        - 设置指令：AT+IFCFG=<fname>,<IP>,netmask,<netmask>, gateway,<gateway>，AT+IFCFG=<ifname> [<swit>] 
        - 查询指令：AT+IFCFG
    
    2.  示例：
        - AT+IFCFG=ap0, 192.168.3.1,netmask,255.255.255.0,gateway,192.168.3.1 
        - 配置网卡 ap0 的 IP、子网掩 码、网关

- AT+PS Wi-Fi 低功耗设置。
    1.  格式：AT+PS=<switch>

    2.  示例：AT+PS=0

    3.  注意：低功耗命令，需要在Wi-Fi关联并获取 IP 之后下发，否则有可能不生效。

- AT+RST 复位单板
    1.  格式：执行命令 ：AT+RST

    2.  示例：AT+RST

### STA相关AT指令
> station模式（客户端模式）在此模式下，模块相当于一个客户端，可以链接到其他路由器发出的WIFI信号。主要应用在网络通信中。 
- AT+STARTSTA 启动 STA。
- AT+STOPSTA 关闭 STA。
- AT+RECONN 配置重连策略。
- AT+SCAN 发起 STA 扫描。
- AT+SCANCHN 指定信道扫描。
- AT+SCANSSID 指定 ssid 扫描。
- AT+SCANRESULT 查看 STA 扫描结果。
- AT+CONN 发起与 AP 的连接。
- AT+FCONN 发起与 AP 的快速连接。
- AT+DISCONN 断开与 AP 的连接。
- AT+STASTAT 查看 STA 状态。
- AT+PBC wps pbc 连接。
- AT+PIN wps_pin 连接。
- AT+PINSHOW 显示生成的 pin 码
### SoftAP 相关 AT 指令
> SoftAP模式（软路由模式）在此模式下，模块本身相当于一个路由器，其他设备可链接到该模块发送的信号，主要应用在主从设备的主机部分。 
- AT+STARTAP 普通模式启动 SoftAP。
- AT+SETAPADV 配置 SoftAP 启动参数。
- AT+STOPAP 停止 SoftAP。
- AT+SHOWSTA AP 显示当前连接的 STA 信息
- AT+DEAUTHSTA AP 断开STA连接
### Repeater 相关 AT 指令
> 中继器（RP repeater）是工作在物理层上的连接设备。适用于完全相同的两个网络的互连，主要功能是通过对数据信号的重新发送或者转发，来扩大网络传输的距离。 
- AT+BRCTL 配置 Repeater 特性开关、网络接口以及相关信息显示
### TCP/IP 相关 AT 指令
- AT+IPSTART 创建 socket ，TCP 协议发起连接。
- AT+IPSEND 发送 TCP/UDP 数据。
- AT+IPLISTEN 启动 TCP 监听。
- AT+IPCLOSE 删除 socket ，TCP 协议断开连接。
- +IPD 接收 TCP/UDP 
### 测试调试相关 AT 指令
- AT+ALTX 设置常发功能
- AT+ALRX 设置常收功能。
- AT+RXINFO 查询常收。
- AT+CALTONE 设置单音功能

## 指令说明
### SLE AT指令
> 星闪接入层包括SLB(SparkLink Basic)和 SLE(Sparklink Low Energy)
- AT+SLEENABLE 
   1. 功能：SLE 使能

   2. 参数：
      设置 SLE 广播参数 设备公开句柄，类型，最小周期，最大周期，本端地址类型，对端设备地址

- AT+SLESETADVDATA 
   1. 功能：设置 SLE 广播参数，要发送的信号

   2. 参数：
      - <announce_handle>：设备公开句柄， 取值范围[0, 0x10] <announce_mode>：设备公开类型
      -  < announce_interval_min>  ： 最 小 设 备 公 开 周 期 , 0x000020~0xffffff, 单位 125u 
      -  <announce_interval_max> ：最大设备公开周期,0x000020~0xffffff, 单位 125u
      -  0是公有地址，6是私有地址
      -  <own_addr_addr> ：SLE 本端设备
      -  <peer_addr_type> ：SLE 对端设备
      -  <peer_addr_addr> ：SLE 对端设备地址 

   3. 返回值：成功：OK，失败：ERROR

   4. 注意：此命令需在 SLE 使能 AT+SLEENABLE 后下发 
- AT+SLESTARTADV 起 SLE 广播
   1. 功能：开启广播

   2. 参数:<adv_handle> ：adv handle, 取值范围[0, 0x10]

   3. 返回值：成功：OK，失败：ERROR

   4. 注意：此命令需在 SLE 使能 AT+SLEENABLE 后

- AT+SLESTOPADV 停 SLE 广播
   1. 功能：停止广播

   2. 参数：<adv_handle> ：adv handle

   3. 返回值：成功：OK，失败：ERROR

- AT+SLESTARTSCAN 启动扫描
- AT+SLESTOPSCAN 关闭扫描
- AT+SLESETNAME 设置本端名称
- AT+SLEGETNAME 获取本端名称
- AT+SLESETADDR 设置本端地址
- AT+SLEGETADDR 获取本端地址
- AT+SLECONN 建立 SLE 连接
- AT+SLEDISCONN 断开 SLE 连接
- AT+SLESETPHY 设置 SLE
- AT+SLEDEFAULTCON N设置 SLE 默认连接参数
- AT+SLEPAIR 进行加密配对
- AT+SLEUNPAIR 移除加密配对
- AT+SLEGETPAIREDNUM获取配对设备数目
- AT+SLEGETPAIRDEV 获取配对设备
- AT+SLEGETPAIRSTA 获取配对状态
- AT+SLEGETBONDDEV 获取绑定设备状态
- AT+SLECONNPARUPD星闪逻辑链路更新参数
- AT+SLEREADPEERRS SI读取对端 rssi
- AT+SSAPSADDSRV 注册服务端
- AT+SSAPSDELALLSRV 删除服务端
- AT+SSAPSADDSERV 添加服务
- AT+SSAPSSYNCADDS ERV添加服务同步
- AT+SSAPSADDPROPE RTY添加属性
- AT+SSAPSSYNCADDP ROPERTY添加属性同步
- AT+SSAPSADDDESCR 添加属性描述符
- AT+SSAPSSYNCADDD ESCR添加属性描述符同步
- AT+SSAPSSTARTSER V start servic
- AT+SSAPSSNDNTFY 服务端向客户端发送通知
- AT+SSAPSNTFYBYUUI D服务端向客户端通过uui发送通知
- AT+SSAPSSNDRESP 服务端向客户端发送响应
- AT+SSAPSREGCBK 服务端注册回调函数
- AT+SSAPCREGCBK 注册 SSAPC 回调函数
- AT+SSAPCFNDSTRU 发现 service
- AT+SSAPCWRITECMD 客户端向服务端写入数据
- AT+SSAPCWRITEREQ 客户端向服务端发送写请求
- AT+SSAPCEXCHINFO 客户端发起信息交换
- AT+SSAPCREADBYUU ID客户端通过 uuid 发送读请求
- AT+SSAPCREADREQ 客户端读取服务端属性数据
- AT+SLESETSCANPAR 设置扫描参数