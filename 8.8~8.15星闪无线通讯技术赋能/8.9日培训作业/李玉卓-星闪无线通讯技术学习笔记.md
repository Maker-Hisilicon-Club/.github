# 李玉卓-星闪无线通讯技术学习笔记





## SLE通讯案例详细整理

 SSAP:Source Service Access Protocol(源服务访问协议)



- #### 配置服务端，启动广播

  ------

  **1.选择一块开发板作为服务端，发送使能SLE指令**

​             **指令**：AT+SLEENABLE  

​             **指令描述**：SLE使能      （enable:使能）

​             **响应**：OK （AT通讯正常）



​      **2.发送注册服务端指令**

​             **指令**：AT+SSAPSADDSRV=0x1234     

​             **设置指令**：（AT+SSAPSADDSRV=<uuid>）

​             **指令描述**：注册服务端

​             **响应**：OK（AT通讯正常）



​      **3.发送添加服务指令**

​            **指令**：SSAPSADDSERV=0x2222,1        

​            **设置指令**：（AT+SSAPSADDSRV=<uuid>,<is_primary>）

​            **指令描述**：添加服务

​            **响应**：OK（AT通讯正常）



​     **4.发送添加属性响应**

​           **指令**：AT+SSAPSADDPROPERTY=1,0x2323,5,5,2,0x1234     (**property**:属性)

​           **设置指令**：AT+SSAPSADDPROPERTY=<service_handle>,<uuid>,<permissions>,<operate_indication>,                               <value_len>,<value> 

​           **参数说明**：<service_handle>：服务的handle

​                              <uuid>： SSAP 特 征的UUID

​                              <permissions>：特征权限

​                              <operate_indication>： 操作指示

​                               <value_len>： 响应的数据长度

​                               <value> ：响应的数据

​           **指令描述**：添加属性  （property:属性)

​            **响应**：OK（AT通讯正常）



​     **5.发送添加属性描述符指令**

​           **指令**：AT+SSAPSADDDESCR=1,2,0x3333,5,5,2,2,0x0200    （**descr**ibe:描述）

​           **设置指令**：AT+SSAPSADDDESCR=<service_handle>,<property_handle>,<uuid>,<permissions>,<operate_indication>,  <type>,<value_len>,<value> 

​           **参数说明**：<service_handle>：服务handle

​                              <property_handle>:属性handle

​                              <uuid>:SSAP 描述符 UUID

​                              <permissions>:特征权限

​                              <operate_indication>:操作指示

​                              <type>：描述符类型

​                               <value_len>：数据长度

​                               <value> ：数据

​           **指令描述**：添加属性描述符

​           **响应**：OK（AT通讯正常）



​     **6发送注册SSAP回调函数指令**        

​          **指令**：AT+SSAPSREGCBK       （**reg**ister:注册    **c**all**b**ac**k**:回调）

​          **指令描述**：服务端注册回调函数

​          **响应**：OK（AT通讯正常）



​     **7.发送开启服务指令**

​          **指令**：AT+SSAPSSTARTSERV      （start service:开启服务）

​          **指令描述**：开启服务

​          **响应**：OK（AT通讯正常）



​     **8.发送配置广播参数指令**

​          **指令**：AT+SLESETADVPAR=1,3,200,200,0,0x112233445588,0,0x112233445588  （set adv **par**ameter:设置广播参数）

​          **设置指令**：AT+SLESETADVPAR=<announce_handle>,<announce_mode>,<announce_interval_min>,<announce_interval_max>,<own_addr_type>,<own_addr_addr>,<peer_addr_type>,<peer_addr_addr>

​          **参数说明**：<announce_handle>：设备公开句柄， 取值范围[0, 0x10] 
                             <announce_mode>：设备公开类型

​                             <announce_interval_min>：最 小 设 备 公 开 周 期 , 0x000020~0xffffff, 单位 125us
                             <announce_interval_max> ：最大设备公开周期, 0x000020~0xffffff, 单位 125us
                             <own_addr_type>:SLE 本端地址类型， 取值范围：● 0：公有地址
                                                                                                                     ● 6：随机地址

​                             <own_addr_addr>:SLE 本端设备地址

​                             <peer_addr_type>:SLE 对端设备地址类型取值： 0- 公有地址, 6- 随机地址

​                              <peer_addr_addr>:SLE 对端设备地址
 

​          **指令描述**：设置SLE指令参数

​          **响应**：OK（AT通讯正常）



​    **9.发送配置广播数据指令**

​          **指令**：AT+SLESETADVDATA=1,10,4,aabbccddeeff11223344,11224455   （set adv data:设置广播数据）

​          **设置指令**：AT+SLESETADVDATA=<adv_handle>,<announce_data_len>,<seek_rsp_data_len>,<announce_data>,<seek_rsp_data>

​          **参数说明**：<adv_handle>：：广播 handle，取值范围[0, 0x10] 

​                              <announce_data_len>：设备公开数据长度

​                              <seek_rsp_data_len>：扫描响应数据长度

​                              <announce_data>：设备公开数据(hex 类型字符串，最大长度521个字符）

​                              <seek_rsp_data>：扫描响应数据(hex 类型字符串，最大长度521 个字符）

​          **响应**：OK（AT通讯正常）



   **10.发送开始广播指令**

​          **指令**：AT+SLESTARTADV=1     （start adv:开始广播）

​          **设置指令**：AT+SLESTARTADV=<adv_enable>

​          **参数说明**：取值范围[0, 0x10]

​          **响应**：OK(AT通信正常)







- #### 配置客户端，启动扫描

  ------

  **1.选择一块开发板作为客户端，发送使能SLE指令**

     **指令**：AT+SLEENABLE  （enable:使能）

​           **响应**：OK(AT通信正常)

​       **2.发送注册SSAPC回调函数指令**

​           **指令**：AT+SSAPCREGCBK

​            **响应**：OK(AT通信正常)

​      **3.建立SLE连接指令**

​           **指令**：AT+SLECONN=0,112233445588  （connect:连接）

​           **设置指令**：AT+SLECONN=<sle_addr_type>,<sle_addr>

​           **参数说明**：<sle_addr_type>：SLE 设备地址类型取值范围如下： 0：公有地址； 6：随机地址
                              <sle_addr>：SLE 设备地址                                             


​            **响应**：OK(AT通信正常)







- #### 服务端与客户端通信

  ------

  **1.服务端向客户端发送通知**

​            **指令**：AT+SSAPSSNDNTFY=0,1,0,2,0xAA55    （Service Send Notify：服务端发送通知）

​            **设置指令**：AT+SSAPSSNDNTFY=<conn_id>,<handle>,<type>,<value_len>,<value>

​            **参数说明**：<value_len>：数据长度

​                               <type>：SSAP 特征类型

​                                <value>：数据

​             **响应**：服务端返回值OK，客户端打印出服务端发送的数据（AT通讯正常）



​      **2.客户端向服务端发送通知**

​            **指令**：AT+SSAPPCWRITECMD=0,0,2,0,2,0x8899     (personal computer write command)

​            **设置指令**：AT+SSAPPCWRITECMD=<client_id>,<conn_id>,<handle>,<type>,<len>,<write_data>

​            **参数说明**：<client_id>：客户端id

​                               <conn_id>:连接id

​                                <handle>:连接handle

​                                 <type>:客户端类型, 取值：0/1/3 
                                  <write_data>:写入数据段

​            **指令描述**：客户端向服务端发送写请求

​            **响应**：客户端返回值OK，服务端打印出客户端发送的数据（AT通信正常）

